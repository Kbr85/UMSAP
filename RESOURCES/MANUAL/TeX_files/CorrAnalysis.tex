\chapter{Correlation Analysis}
\label{chap:corrA}

The Correlation Analysis utility calculates the correlation in the MS data used
as input for UMSAP.

\section{The interface}

The Correlation Analysis tab is divided in four regions (\autoref{fig:utilCorrAnalysis}).

\begin{figure}[h]
    \centering
    \includegraphics[width=0.7\textwidth]{./IMAGES/UTIL-CORR-WINDOW/util-corr.jpg}
    \caption[The Correlation Analysis tab]{\textbf{The Correlation Analysis tab.}
    This tab allows to perform a correlation analysis of the data contained in a
    given Data file.} 
    \label{fig:utilCorrAnalysis}
    \vspace{-5pt}
\end{figure}

Region Files contains two buttons and a text field. Here users select the input
and output files for the analysis.

\num{1}. The button UMSAP allows users to browse the file system to select the location
and name of the .umsap file. When selecting an already existing .umsap file the operating
system will ask if it is ok to replace the file, the answer can be yes since UMSAP
will never overwrite or replace an .umsap file, instead the new analysis will be
added to the already existing file. Only .umsap files can be selected here.

\num{2}. The button Data allows users to browse the file system to select the input
data file that will be used for the analysis. The Data file is expected to be a
plain text file with tab separated columns and the name of the columns in the first
row of the file. In addition, columns to be analyzed must contain only numbers and
must be of the same length. Only .txt files can be selected here.

\num{3}. The text field Analysis ID allows users to provide an ID for the analysis
to be run. The date and time of the analysis will be automatically added to the
beginning of the name.

Region Data Preparation contains four dropdown boxes. Here users select how the data
in the Data file should be prepared before starting the analysis.

\num{1}. The dropdown Treat \num{0}s as missing values allows user to define how
to handle \num{0} values present in the Data file.

\num{2}. The dropdown Transformation allows user to select the Transformation method
to be applied to the data.

\num{3}. The dropdown Normalization allows users to select the Normalization method
to be applied to the data.

\num{4}. The dropdown Imputation allows user to select the Imputation method used
to replace missing values in the data.

Region User-defined values contains one dropdown box.

\num{1}. The dropdown Correlation Method allows users to select the correlation method
to use.

Region Column numbers contains two lists and a button. Here users select the columns
in the Data file to be used in the Correlation Analysis.

\num{1}. The list to the left will display the names of the columns present in the
selected Data file. The list is automatically filled once the Data file is selected.
Rows in the list can not be deleted, except in the case of loading a different Data
file or using the Clear All button at the bottom of the tab. Selected rows can be
copied with the Cmd+C shortcut.

\num{2}. The list to the right will contain the columns in the Data file that will
be used for the Correlation Analysis. This list must contain at least two rows for
the analysis to proceed. Selected rows in this list can be deleted with the Cmd+X
shortcut and rows already copied from the list in the left can be pasted with the
Cmd+V shortcut. While pasting the rows, duplicate rows will be silently discarded.
Importantly, the order of the rows and columns in the matrix containing the correlation
coefficients will be the same as the order of the columns in this list. Therefore,
users are advised to fill the list in such a way that replicates of the same experiment
are consecutive to each other in the list.

\num{3}. The button Add columns will add the selected rows in the left list to
the right list. The rows will be added to the right list in the same order as
they are selected in the left list. Duplicate rows will be silently discarded.

The bottom of the tab contains three buttons.

\num{1}. The button Help leads to an online tutorial about Correlation Analysis in
UMSAP.

\num{2}. The button Clear All will delete all user input from the tab.

\num{3}. The button Start Analysis starts the Correlation Analysis.

\section{The analysis}

First, UMSAP will check the validity of the user provided input. Then, columns in
the right list are read from the Data file. The columns must contain only numbers
and the same amount of rows must be found in all columns. Failing to comply with
this will result in the program aborting the analysis. After this, all steps selected
in the Data Preparation region are carried out (\autoref{chap:dataPrep}). Finally,
the correlation coefficients are calculated using the selected method. If any of
the coefficients cannot be calculated, then the corresponding coefficient is set to NA.

\section{The output}

\begin{figure}[h]
    \centering
    \includegraphics[width=0.7\textwidth]{./IMAGES/UTIL-CORR-WINDOW/util-corr-res.jpg}
    \caption[The Correlation Analysis result window]{\textbf{The Correlation Analysis
    result window.} The correlation coefficients are shown as a color coded matrix.
    Values between \numrange{-1}{0} are shown in shades of red, \num{0} is shown in
    white and values between \numrange{0}{1} in shades of blue. NA values are shown
    in green.}
    \label{fig:utilCorrAnalysisRes}
    \vspace{-5pt} 	
\end{figure} 

The correlation coefficients resulting from a Correlation Analysis will be shown
as a color coded matrix (\autoref{fig:utilCorrAnalysisRes}). Values between \numrange{-1}{0}
will be shown in shades of red, \num{0} will be shown as white and values between
\numrange{0}{1} will be shown in shades of blue. NA values will be shown in green.
The columns and rows of the matrix are the column names used to calculate the correlation
coefficients. Information about a specific matrix element can be obtained by simply
placing the mouse pointer over the matrix element.

\section{The Tools menu}

The Tools menu in the window showing the correlation coefficients allows user to
view any of the Correlation Analysis contained in the selected .umsap file or to
modify the appearance of the displayed plot. For example, the column numbers can
be displayed instead of the column names or the color bar can be hidden. In addition,
only a subset of the columns can be shown using the Select Columns entry.

The Tools menu also allows duplicating the window (Cmd+D) for easier comparison of
two or more analysis, checking the Data Preparation steps of the analysis (Cmd+P),
creating an image of the plot (Cmd+I), exporting the correlation coefficient matrix
to a tab separated CSV file (Cmd+E) and resetting the zoom level of the plot (Cmd+Z).

